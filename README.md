# A股QQE趋势策略监控系统

基于QQE（Quantitative Qualitative Estimation）和趋势分析的A股选股系统，支持批量监控和单股分析。

## 功能特点

✅ **双模式策略**
- 严格模式：高质量、少信号、高确定性
- 标准模式：信号较多、适合活跃交易

✅ **信号质量评分**
- 0-100分量化评分系统
- 多维度综合评估（趋势、成交量、RSI、价格位置）

✅ **灵活的筛选范围**
- 创业板（300/301开头）
- 科创板（688开头）
- 全部A股市场

✅ **多种使用方式**
- 批量监控：扫描整个市场
- 单股测试：深度分析单只股票
- 对比分析：标准模式vs严格模式
- 回测系统：验证策略有效性，支持止损（v2.3）

## 快速开始

### 安装依赖

```bash
pip install baostock pandas numpy
```

### 基础使用

```bash
# 批量监控（随机20只创业板+科创板股票）
python batch_monitor.py --random

# 测试单只股票
python batch_monitor.py --stock 300750

# 详细分析单只股票
python single_stock_test.py 300750 --details

# 回测策略（v2.3新增止损功能）
python backtest.py --max-stocks 100 --quality-thresholds 60,70,80 --stop-loss 0.10
```

## 使用指南

### 1. 批量监控

批量扫描市场，找出符合买入条件的股票。

```bash
# 默认：创业板+科创板，随机20只，严格模式，质量≥60分
python batch_monitor.py --random

# 监控创业板，50只股票
python batch_monitor.py --board chinext --max-stocks 50 --random

# 监控科创板，更高质量要求
python batch_monitor.py --board star --random --min-quality 70

# 全市场扫描（耗时较长）
python batch_monitor.py --board all --max-stocks 100 --random

# 使用标准模式（信号更多）
python batch_monitor.py --random --no-strict

# 自定义历史数据天数和检查天数（新功能）
python batch_monitor.py --random --history-days 150 --check-days 5
```

**参数说明**：

| 参数 | 说明 | 可选值 | 默认值 |
|------|------|--------|--------|
| `--board` | 板块筛选 | chinext/star/chinext+star/all | chinext+star |
| `--max-stocks` | 监控股票数量 | 整数 | 20 |
| `--random` | 随机采样 | - | False |
| `--no-strict` | 使用标准模式 | - | False（严格模式） |
| `--min-quality` | 最低质量分数 | 0-100 | 60 |
| `--history-days` | 历史数据天数 | 60-500 | 120 |
| `--check-days` | 检查最近几天 | 1-10 | 2 |
| `--delay` | 请求间隔(秒) | 浮点数 | 0.1 |

**输出示例**：

```
================================================================================
开始批量监控A股股票池...
================================================================================
板块范围: 创业板+科创板
筛选模式: 严格模式
质量阈值: 60分
股票池总数: 20
检查范围: 最近2天内的买入信号
================================================================================
进度: 20/20 - sz.300999 金龙鱼  
>>> 发现买入信号: sz.300750 宁德时代 - 买入日期: 2026-01-30 - 质量: 75.3分

================================================================================
监控完成! 找到 3 只股票出现买入信号
================================================================================

买入信号详情 (按质量排序):
----------------------------------------------------------------------------------
代码        名称          买入日期      买入价    当前价    盈亏      盈亏%     质量    
----------------------------------------------------------------------------------
sz.300750  宁德时代      2026-01-30  328.50  335.20  +6.70   +2.04%  75.3   
sz.688981  中芯国际      2026-01-29  45.20   46.80   +1.60   +3.54%  72.1   
sz.300059  东方财富      2026-01-31  18.90   19.20   +0.30   +1.59%  68.5   

汇总:
  买入信号数量: 3
  平均质量: 71.9分
  平均盈亏: 2.84 (+2.39%)
  盈利: 3, 亏损: 0
  胜率: 100.00%

发现的股票代码列表 (按质量从高到低):
----------------------------------------------------------------------------------
  sz.300750  sz.688981  sz.300059
----------------------------------------------------------------------------------

Top 5 高质量信号:
----------------------------------------------------------------------------------
1. sz.300750 宁德时代 - 质量: 75.3分
2. sz.688981 中芯国际 - 质量: 72.1分
3. sz.300059 东方财富 - 质量: 68.5分
----------------------------------------------------------------------------------
```

### 2. 单股票测试

#### 方式A: 快速测试

使用 `batch_monitor.py --stock` 快速查看单只股票。

```bash
# 基本测试
python batch_monitor.py --stock 300750

# 降低质量要求
python batch_monitor.py --stock 300750 --min-quality 50

# 使用标准模式
python batch_monitor.py --stock 300750 --no-strict
```

#### 方式B: 详细分析

使用 `single_stock_test.py` 进行深度分析。

```bash
# 基础分析
python single_stock_test.py 300750

# 显示详细技术指标
python single_stock_test.py 300750 --details

# 显示所有买入卖出信号记录（新功能）
python single_stock_test.py 300750 --all-signals

# 完整分析（推荐）
python single_stock_test.py 300750 --all-signals --details

# 更多历史数据
python single_stock_test.py 300750 --days 200 --all-signals --details
```

**详细分析输出**：
- 历史买入/卖出信号统计
- **所有买入信号记录（表格形式）**
- **所有卖出信号记录（表格形式）**
- **买入-卖出配对分析（收益率和持有天数）**
- 最近5个买入信号详情
- 最近2天信号分析
- 当前状态分析（趋势、RSI、QQE等）
- 历史回测统计（平均收益、胜率等）

### 3. 对比测试

对比标准模式和严格模式的差异。

```bash
python compare_modes.py
```

这将测试几只股票，显示：
- 两种模式的信号数量对比
- 信号减少比例
- 严格模式的平均质量分数

### 4. 回测系统（新增）

验证策略在不同质量阈值下的表现。

```bash
# 基本回测（100只股票，测试多个质量阈值）
python backtest.py

# 自定义回测配置
python backtest.py --board chinext+star --max-stocks 200 \
  --quality-thresholds 60,70,80

# 全面回测
python backtest.py --board all --max-stocks 500 \
  --quality-thresholds 50,60,70,75,80 --history-days 300
```

**回测功能**：
- ✅ 多质量阈值对比（如 60分 vs 70分 vs 80分）
- ✅ 详细性能指标（胜率、盈亏比、夏普比率、最大回撤等）
- ✅ 真实交易成本模拟（手续费、滑点）
- ✅ CSV格式结果导出
- ✅ 自动生成对比分析表格

**回测指标**：
- 总交易次数、胜率
- 平均收益、累计收益
- 最大回撤、夏普比率
- 盈亏比、平均持有天数
- **止损统计**（v2.3新增）：止损次数、止损率、退出原因分析

详细使用请查看 [BACKTEST_GUIDE.md](BACKTEST_GUIDE.md) 和 [STOP_LOSS_GUIDE.md](STOP_LOSS_GUIDE.md)

## 策略说明

### 核心策略：QQE + Trend

基于以下技术指标：
- **Primary QQE**：主要动量指标
- **Secondary QQE**：次要动量指标
- **Bollinger Bands**：波动率通道
- **Heikin Ashi MA**：趋势均线
- **成交量**：资金流向

### 严格模式的8个过滤条件

1. **趋势强度** > 10：只在强趋势中买入
2. **成交量放大** > 1.2倍：确认资金介入
3. **价格动能**：连续2天上涨
4. **RSI不过高** < 70：避免追高
5. **价格位置** < 80%：不在高位买入
6. **QQE双重确认**：两个指标同时上升
7. **趋势持续**：强趋势至少持续2天
8. **价格突破** > 2%：有效突破

### 信号质量评分

| 因素 | 权重 | 说明 |
|------|------|------|
| 趋势强度 | 40分 | 趋势越强，得分越高 |
| 成交量 | 30分 | 放量越大，得分越高 |
| RSI位置 | 15分 | RSI越低，得分越高 |
| 价格位置 | 15分 | 价格越低，得分越高 |

**评级标准**：
- 80+分：⭐⭐⭐⭐⭐ 优秀
- 70-80分：⭐⭐⭐⭐ 良好
- 60-70分：⭐⭐⭐ 一般
- 60分以下：⭐⭐ 较差

## 文件说明

| 文件 | 说明 |
|------|------|
| `qqe_trend_strategy.py` | 核心策略算法 |
| `batch_monitor.py` | 批量监控和单股快速测试 |
| `single_stock_test.py` | 单股详细分析工具 |
| `backtest.py` | 回测系统（v2.3支持止损） |
| `compare_modes.py` | 标准模式vs严格模式对比 |
| `test_baostock.py` | 数据接口测试 |
| `STRATEGY_OPTIMIZATION.md` | 策略优化详细说明 |
| `SINGLE_STOCK_GUIDE.md` | 单股测试使用指南 |
| `BACKTEST_GUIDE.md` | 回测系统使用指南 |
| `STOP_LOSS_GUIDE.md` | 止损功能详细说明（v2.3新增） |
| `PARAMETERS.md` | 参数详细说明和使用示例 |
| `SCAN_ALL_STOCKS.md` | 监控所有股票使用指南 |
| `UPDATE_V2.3.md` | v2.3版本更新说明 |

## 使用建议

### 日常选股流程

```bash
# 1. 每天收盘后扫描市场（检查今天的信号）
python batch_monitor.py --board chinext+star --random --max-stocks 100 \
  --min-quality 70 --check-days 1

# 2. 发现感兴趣的股票后，详细分析
python single_stock_test.py 300750 --details

# 3. 对比不同模式
python single_stock_test.py 300750          # 严格模式
python single_stock_test.py 300750 --no-strict  # 标准模式

# 4. 周末回测（检查本周的信号，使用更多历史数据）
python batch_monitor.py --random --max-stocks 200 \
  --history-days 200 --check-days 5
```

### 仓位管理建议

- **80+分信号**：可以考虑较大仓位（30-40%）
- **70-80分**：适中仓位（20-30%）
- **60-70分**：小仓位或观察（10-20%）

### 风险控制

- 即使高质量信号也要设置止损
- 建议止损点：买入价下方5-8%
- 分批买入降低风险
- 关注趋势转弱信号

## 常见问题

**Q: 为什么严格模式几乎没有信号？**

A: 严格模式设计就是为了"少而精"。可以：
- 降低质量阈值：`--min-quality 50`
- 增加扫描数量：`--max-stocks 100`
- 使用标准模式：`--no-strict`

**Q: 如何提高信号质量？**

A: 
- 使用严格模式（默认）
- 提高质量阈值：`--min-quality 70`
- 只关注Top 5高质量信号

**Q: 支持哪些股票？**

A: 
- 创业板：300/301开头
- 科创板：688开头
- 沪深A股：全部
- 自动过滤ST和退市股

**Q: 数据来源？**

A: 使用baostock提供的免费A股数据，后复权价格。

## 免责声明

本系统仅供学习和研究使用，不构成投资建议。

- ⚠️ 股市有风险，投资需谨慎
- ⚠️ 历史表现不代表未来收益
- ⚠️ 请根据自身风险承受能力做出投资决策
- ⚠️ 使用本系统产生的任何损失，开发者不承担责任

## 更新日志

### v2.3 (2026-02-01)
- ✅ 新增完整回测系统 `backtest.py`
- ✅ 支持多质量阈值对比回测
- ✅ 详细性能指标分析（胜率、盈亏比、夏普比率、最大回撤等）
- ✅ 真实交易成本模拟（手续费、滑点）
- ✅ CSV格式结果导出
- ✅ 新增 BACKTEST_GUIDE.md 使用指南
- ✅ 支持监控所有股票（--max-stocks all）

### v2.2 (2026-02-01)
- ✅ 新增 `--all-signals` 参数：显示所有买入卖出信号记录
- ✅ 新增买入-卖出配对分析功能
- ✅ 优化信号展示：支持表格形式显示所有交易记录
- ✅ 新增持有天数和收益率统计

### v2.1 (2026-02-01)
- ✅ 新增 `--history-days` 参数：自定义历史数据天数
- ✅ 新增 `--check-days` 参数：自定义检查最近几天的信号
- ✅ 优化默认参数：历史数据从100天增加到120天
- ✅ 新增 PARAMETERS.md 详细参数说明文档

### v2.0 (2026-02-01)
- ✅ 新增严格模式，大幅提高信号质量
- ✅ 新增信号质量评分系统（0-100分）
- ✅ 支持单只股票测试和详细分析
- ✅ 新增对比测试工具
- ✅ 优化输出格式，支持质量排序

### v1.0
- ✅ 基础QQE+Trend策略实现
- ✅ 批量监控功能
- ✅ 支持创业板和科创板筛选

## 联系方式

如有问题或建议，欢迎提Issue。
# Tradingview_Stocks
