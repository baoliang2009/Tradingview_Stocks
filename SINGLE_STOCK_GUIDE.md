# 单只股票测试使用指南

## 概述

现在支持两种方式测试单只股票：
1. **简单测试** - 使用 `batch_monitor.py --stock`
2. **详细分析** - 使用 `single_stock_test.py`

## 方法1: 简单测试（快速查看）

使用 `batch_monitor.py` 的 `--stock` 参数进行快速测试。

### 基本用法

```bash
# 测试单只股票（自动识别市场）
python batch_monitor.py --stock 300750

# 也支持带市场前缀的代码
python batch_monitor.py --stock sz.300750

# 使用标准模式
python batch_monitor.py --stock 300750 --no-strict

# 降低质量阈值
python batch_monitor.py --stock 300750 --min-quality 50
```

### 输出示例

```
================================================================================
单只股票测试
================================================================================
股票代码: sz.300750
股票名称: 宁德时代
数据范围: 2025-10-24 至 2026-02-01
数据天数: 70 天
分析模式: 严格模式
质量阈值: 60分
================================================================================

✅ 发现买入信号！
--------------------------------------------------------------------------------
信号日期: 2026-01-30
买入价格: 328.50
当前价格: 335.20
盈亏: +6.70 (+2.04%)
信号质量: 75.3分
质量评价: ⭐⭐⭐⭐ 良好
--------------------------------------------------------------------------------
```

## 方法2: 详细分析（深度分析）

使用专门的 `single_stock_test.py` 进行详细分析。

### 基本用法

```bash
# 基础测试
python single_stock_test.py 300750

# 显示详细技术指标
python single_stock_test.py 300750 --details

# 显示所有买入卖出信号记录（新功能）🆕
python single_stock_test.py 300750 --all-signals

# 组合使用
python single_stock_test.py 300750 --all-signals --details

# 使用标准模式
python single_stock_test.py 300750 --no-strict

# 获取更多历史数据
python single_stock_test.py 300750 --days 200

# 完整分析（推荐）
python single_stock_test.py 300750 --all-signals --details --days 200
```

### 详细输出

详细分析模式会显示：

1. **基本信息**
   - 股票代码和名称
   - 数据范围和天数
   - 分析模式

2. **信号统计**
   - 历史买入信号数量
   - 历史卖出信号数量

3. **所有买入信号记录**（使用 `--all-signals`）🆕
   - 完整的买入信号列表（表格形式）
   - 每个信号的日期、价格、涨幅、趋势、RSI、质量分数
   
4. **所有卖出信号记录**（使用 `--all-signals`）🆕
   - 完整的卖出信号列表（表格形式）
   - 每个信号的日期、价格、跌幅、趋势、RSI

5. **买入-卖出配对分析**（使用 `--all-signals`）🆕
   - 自动配对每次买入和卖出
   - 显示每笔交易的收益率和持有天数
   - 区分已卖出和持有中的仓位

6. **最近买入信号详情**
   - 最近5个买入信号（不使用 `--all-signals` 时）
   - 每个信号的价格、涨幅、质量分数
   - 趋势强度和RSI值

7. **最近2天信号分析**
   - 是否有最近的买入机会
   - 当前盈亏情况
   - 信号质量评级（⭐评分）

8. **当前状态分析**
   - 最新收盘价
   - 趋势值和方向
   - RSI指标
   - QQE值
   - 多空状态判断

9. **详细技术指标**（使用 `--details`）
   - 最近5天的详细数据
   - 包括收盘价、趋势、RSI、QQE、质量分数

10. **历史回测统计**
    - 总交易次数
    - 平均收益率
    - 最大收益/亏损
    - 胜率统计

### 示例输出（使用 --all-signals）🆕

```
================================================================================
单只股票测试
================================================================================
股票代码: sz.300750
股票名称: 宁德时代
数据范围: 2025-10-24 至 2026-02-01
数据天数: 70 天
分析模式: 严格模式
================================================================================

买入信号数量: 5
卖出信号数量: 3

==========================================================================================
所有买入信号记录:
==========================================================================================
序号  日期          开盘价    收盘价    涨幅%     趋势      RSI       质量    
------------------------------------------------------------------------------------------
1   2025-11-05  305.20  312.50  2.39    12.34   58.20   68.5    
2   2025-11-28  315.80  322.10  2.00    15.67   61.45   72.3    
3   2025-12-15  310.20  318.50  2.68    14.89   59.91   70.8    
4   2026-01-08  325.60  331.20  1.72    13.45   62.30   66.2    
5   2026-01-30  328.50  335.20  2.04    16.23   63.45   75.3    
==========================================================================================

==========================================================================================
所有卖出信号记录:
==========================================================================================
序号  日期          开盘价    收盘价    跌幅%     趋势      RSI       
------------------------------------------------------------------------------------------
1   2025-11-20  318.90  312.40  -2.04   -8.56   45.20   
2   2025-12-28  320.50  315.80  -1.47   -6.89   43.75   
3   2026-01-25  330.20  326.80  -1.03   -5.43   46.30   
==========================================================================================

====================================================================================================
买入-卖出配对分析:
====================================================================================================
交易  买入日期      买入价    卖出日期      卖出价    收益率%     持有天数  状态    
----------------------------------------------------------------------------------------------------
1   2025-11-05  305.20  2025-11-20  318.90  +4.49     15      已卖出  
2   2025-11-28  315.80  2025-12-28  320.50  +1.49     30      已卖出  
3   2025-12-15  310.20  2026-01-25  330.20  +6.45     41      已卖出  
4   2026-01-08  325.60  2026-02-01  335.20  +2.95     24      持有中  
5   2026-01-30  328.50  2026-02-01  335.20  +2.04     2       持有中  
====================================================================================================

================================================================================
⚠️  最近2天内有买入信号！
================================================================================

信号日期: 2026-01-30
买入价格: 328.50
当前价格: 335.20
盈亏: +6.70 (+2.04%)
信号质量: 75.3分
质量评价: ⭐⭐⭐⭐ 良好

--------------------------------------------------------------------------------
当前状态分析:
--------------------------------------------------------------------------------
最新收盘价: 335.20
趋势值: 16.23 (上升趋势)
Primary RSI: 65.32
Secondary RSI: 63.45
QQE值: 13.45
当前信号质量: 75.3分

状态: ✅ 多头趋势中

================================================================================
历史信号统计:
================================================================================
总交易次数: 5
平均收益率: 3.48%
最大收益: 6.45%
最大亏损: 1.49%
盈利次数: 5
亏损次数: 0
胜率: 100.00%
```

## 股票代码格式

支持多种代码格式，会自动识别市场：

| 输入格式 | 自动转换 | 市场 |
|---------|---------|------|
| 300750 | sz.300750 | 深圳（创业板） |
| 688981 | sz.688981 | 深圳（科创板） |
| 600519 | sh.600519 | 上海 |
| sz.300750 | sz.300750 | 深圳 |
| sh.600519 | sh.600519 | 上海 |

## 参数说明

### batch_monitor.py --stock

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--stock` | 股票代码 | 必填 |
| `--no-strict` | 使用标准模式 | False（使用严格） |
| `--min-quality` | 最低质量分数 | 60 |

### single_stock_test.py

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `code` | 股票代码（位置参数） | 必填 |
| `--no-strict` | 使用标准模式 | False（使用严格） |
| `--details` | 显示详细指标 | False |
| `--all-signals` | 显示所有信号记录 | False |
| `--days` | 历史数据天数 | 100 |

## 使用场景

### 场景1: 快速验证某只股票

```bash
# 快速看看这只股票有没有买入信号
python batch_monitor.py --stock 300750
```

### 场景2: 深度研究

```bash
# 想详细了解这只股票的历史表现
python single_stock_test.py 300750 --details

# 查看所有买入卖出信号记录（新功能）🆕
python single_stock_test.py 300750 --all-signals

# 完整分析（推荐）🆕
python single_stock_test.py 300750 --all-signals --details --days 200
```

### 场景3: 降低要求查找信号

```bash
# 严格模式没信号，降低质量要求试试
python batch_monitor.py --stock 300750 --min-quality 50
```

### 场景4: 对比两种模式

```bash
# 先看严格模式
python single_stock_test.py 300750

# 再看标准模式
python single_stock_test.py 300750 --no-strict
```

### 场景5: 长期回测

```bash
# 获取更多历史数据进行分析
python single_stock_test.py 300750 --days 200 --details

# 查看完整的交易记录（新功能）🆕
python single_stock_test.py 300750 --days 200 --all-signals
```

### 场景6: 分析所有交易记录（新功能）🆕

```bash
# 查看所有买入卖出信号
python single_stock_test.py 300750 --all-signals

# 完整分析（包含所有信号和详细指标）
python single_stock_test.py 300750 --all-signals --details

# 长期完整分析
python single_stock_test.py 300750 --all-signals --details --days 200
```

## 常见问题

### Q1: 为什么显示"数据不足"？

A: 策略需要至少60个交易日的数据。新股或停牌时间过长的股票可能不足。可以尝试增加 `--days` 参数。

### Q2: 为什么没有买入信号？

A: 可能的原因：
1. 股票近期没有符合条件的买入点
2. 质量阈值设置过高
3. 严格模式过滤太严格

解决方法：
- 降低质量阈值：`--min-quality 50`
- 使用标准模式：`--no-strict`

### Q3: 简单测试和详细分析有什么区别？

A: 
- **简单测试** (`batch_monitor.py --stock`)：只显示最近2天的信号，快速查看
- **详细分析** (`single_stock_test.py`)：显示所有历史信号、回测统计、技术指标等

### Q4: 信号质量分数如何解读？

A:
- 80分以上：⭐⭐⭐⭐⭐ 优秀，强烈推荐
- 70-80分：⭐⭐⭐⭐ 良好，值得关注
- 60-70分：⭐⭐⭐ 一般，谨慎对待
- 60分以下：⭐⭐ 较差，建议观望

## 示例：完整的研究流程

```bash
# 1. 快速检查
python batch_monitor.py --stock 300750

# 2. 发现信号后，深度分析
python single_stock_test.py 300750 --details

# 3. 查看所有交易记录（新功能）🆕
python single_stock_test.py 300750 --all-signals

# 4. 如果没信号，降低要求试试
python batch_monitor.py --stock 300750 --min-quality 50

# 5. 对比标准模式和严格模式
python single_stock_test.py 300750 --all-signals         # 严格模式
python single_stock_test.py 300750 --all-signals --no-strict  # 标准模式

# 6. 查看长期表现（完整分析）🆕
python single_stock_test.py 300750 --days 200 --all-signals --details
```

## 批量测试多只股票

如果想测试多只特定股票，可以写一个简单的shell脚本：

```bash
#!/bin/bash
# test_stocks.sh

stocks=(300750 688981 300059 600519)

for stock in "${stocks[@]}"
do
    echo "测试 $stock ..."
    python batch_monitor.py --stock $stock
    echo ""
done
```

运行：
```bash
chmod +x test_stocks.sh
./test_stocks.sh
```
