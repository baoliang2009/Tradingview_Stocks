# ç­–ç•¥ä¼˜åŒ–å»ºè®®æŠ¥å‘Š

åŸºäºå›æµ‹æ•°æ® `trades_q0_20260203_105408.csv` çš„æ·±åº¦åˆ†æ

---

## ğŸ“Š æ ¸å¿ƒé—®é¢˜è¯Šæ–­

### 1. **èƒœç‡è¿‡ä½ (38.6%)**
- ç›ˆåˆ©äº¤æ˜“: 17ç¬” (38.6%)
- äºæŸäº¤æ˜“: 27ç¬” (61.4%)
- **é—®é¢˜**: è¶…è¿‡60%çš„äº¤æ˜“éƒ½åœ¨äºé’±

### 2. **æ­¢æŸè¿‡äºé¢‘ç¹ (38.6%)**
- æ­¢æŸ17æ¬¡ï¼Œå æ€»äº¤æ˜“çš„38.6%
- æ­¢æŸå¹³å‡äºæŸ: Â¥13,389.75 (7.12%)
- æ­¢æŸå¹³å‡æŒæœ‰: ä»…8.9å¤©
- **é—®é¢˜**: æ­¢æŸæ¯”ä¾‹å›ºå®š7.12%ï¼Œè§¦å‘å¤ªå¿«

### 3. **çŸ­æœŸæŒä»“äºæŸä¸¥é‡**
| æŒä»“æ—¶é•¿ | äº¤æ˜“æ¬¡æ•° | å¹³å‡æ”¶ç›Š |
|----------|----------|----------|
| â‰¤7å¤© | 12 | **-Â¥9,588.58** âŒ |
| 8-14å¤© | 12 | **-Â¥5,467.01** âŒ |
| 15-30å¤© | 6 | Â¥5,997.02 âœ… |
| >30å¤© | 14 | **Â¥14,675.36** âœ…âœ… |

**å…³é”®å‘ç°**: 
- æŒä»“<14å¤©çš„äº¤æ˜“å¹³å‡äºæŸ
- æŒä»“>30å¤©çš„äº¤æ˜“å¹³å‡ç›ˆåˆ©Â¥14,675
- **ç»“è®º**: ç­–ç•¥éœ€è¦æ›´é•¿çš„æŒä»“æ—¶é—´æ¥è·åˆ©

### 4. **æ­¢ç›ˆæ•ˆæœä¼˜ç§€ä½†ä½¿ç”¨å¤ªå°‘**
- æ­¢ç›ˆ7æ¬¡ (ä»…15.9%çš„äº¤æ˜“)
- æ­¢ç›ˆå¹³å‡ç›ˆåˆ©: Â¥23,127.83 (24.84%)
- æ­¢ç›ˆå¹³å‡æŒæœ‰: 29å¤©
- **é—®é¢˜**: å¤ªå¤šäº¤æ˜“åœ¨è¾¾åˆ°æ­¢ç›ˆå‰å°±æ­¢æŸäº†

### 5. **å–å‡ºä¿¡å·è¡¨ç°ä¸­ç­‰**
- ä¿¡å·å–å‡º20æ¬¡ (45.5%)
- èƒœç‡: 50%
- å¹³å‡æ”¶ç›Š: Â¥6,325.05
- **é—®é¢˜**: QQEå–å‡ºä¿¡å·çš„æ—¶æœºå¯èƒ½è¿‡æ—©

---

## ğŸ¯ ä¼˜åŒ–ç­–ç•¥å»ºè®®

### ä¼˜åŒ–æ–¹å‘1: **æ”¾å®½æ­¢æŸï¼Œå¢åŠ æŒä»“æ—¶é—´**

**å½“å‰é—®é¢˜**: 
- æ­¢æŸ7.12%è¿‡äºä¸¥æ ¼
- å¹³å‡8.9å¤©å°±æ­¢æŸï¼Œæ²¡ç»™è¶‹åŠ¿å‘å±•çš„æ—¶é—´

**å»ºè®®æ”¹è¿›**:
```python
# æ–¹æ¡ˆA: æ¸è¿›å¼æ­¢æŸ
- å‰5å¤©: æ­¢æŸ12% (ç»™äºˆæ›´å¤šç©ºé—´)
- 5-15å¤©: æ­¢æŸ10%
- 15å¤©å: æ­¢æŸ8% (å·²ç»ç¡®è®¤è¶‹åŠ¿)

# æ–¹æ¡ˆB: æ³¢åŠ¨ç‡è‡ªé€‚åº”æ­¢æŸ
- é«˜æ³¢åŠ¨è‚¡ç¥¨(ATR>5%): æ­¢æŸ15%
- ä¸­æ³¢åŠ¨è‚¡ç¥¨(ATR 3-5%): æ­¢æŸ10%
- ä½æ³¢åŠ¨è‚¡ç¥¨(ATR<3%): æ­¢æŸ7%
```

**é¢„æœŸæ•ˆæœ**: 
- å‡å°‘è¿‡æ—©æ­¢æŸ
- è®©è¶‹åŠ¿æœ‰æ—¶é—´å‘å±•
- å‡å°‘æ­¢æŸæ¬¡æ•°ä»17æ¬¡é™è‡³10æ¬¡ä»¥ä¸‹

---

### ä¼˜åŒ–æ–¹å‘2: **æå‰éƒ¨åˆ†æ­¢ç›ˆé”å®šåˆ©æ¶¦**

**å½“å‰é—®é¢˜**:
- åªæœ‰7æ¬¡(15.9%)è¾¾åˆ°20%æ­¢ç›ˆ
- å¾ˆå¤šç›ˆåˆ©äº¤æ˜“åœ¨è¾¾åˆ°æ­¢ç›ˆå‰è¢«æ­¢æŸæˆ–ä¿¡å·å–å‡º

**å»ºè®®æ”¹è¿›**:
```python
# å¤šçº§æ­¢ç›ˆç­–ç•¥
- æ¶¨10%: å–å‡º30% (é”å®šéƒ¨åˆ†åˆ©æ¶¦)
- æ¶¨15%: å–å‡º30% (ç»§ç»­é”å®š)
- æ¶¨20%: å–å‡º40% (ä¿ç•™éƒ¨åˆ†æŒä»“)
- å¯ç”¨ç§»åŠ¨æ­¢æŸä¿æŠ¤å‰©ä½™ä»“ä½
```

**é¢„æœŸæ•ˆæœ**:
- å¢åŠ ç›ˆåˆ©äº¤æ˜“çš„å…‘ç°ç‡
- é¿å…ç›ˆåˆ©å›åå˜äºæŸ
- æå‡æ•´ä½“èƒœç‡

---

### ä¼˜åŒ–æ–¹å‘3: **è¿‡æ»¤çŸ­æœŸä¿¡å·ï¼Œå»¶é•¿æŒä»“**

**å½“å‰é—®é¢˜**:
- â‰¤14å¤©çš„äº¤æ˜“å¹³å‡äºæŸÂ¥7,527
- >30å¤©çš„äº¤æ˜“å¹³å‡ç›ˆåˆ©Â¥14,675

**å»ºè®®æ”¹è¿›**:
```python
# æ·»åŠ è¶‹åŠ¿ç¡®è®¤è¿‡æ»¤å™¨
1. ä¹°å…¥å5å¤©å†…ä¸å…è®¸å–å‡ºä¿¡å·é€€å‡º
2. è¦æ±‚è¶‹åŠ¿å¼ºåº¦æŒç»­3å¤©ä»¥ä¸Šæ‰ä¹°å…¥
3. å¢åŠ æˆäº¤é‡ç¡®è®¤(å½“æ—¥æˆäº¤é‡ > 5æ—¥å‡é‡)
```

**é¢„æœŸæ•ˆæœ**:
- è¿‡æ»¤çŸ­æœŸæ³¢åŠ¨é€ æˆçš„å‡ä¿¡å·
- æé«˜äº¤æ˜“è´¨é‡
- å¢åŠ å¹³å‡æŒä»“æ—¶é—´

---

### ä¼˜åŒ–æ–¹å‘4: **å¯ç”¨ä¸¥æ ¼æ¨¡å¼è¿‡æ»¤ä½è´¨é‡ä¿¡å·**

**å½“å‰é—®é¢˜**:
- ä½¿ç”¨`--no-strict`æ¨¡å¼ï¼Œè´¨é‡åˆ†æ•°å…¨ä¸º0
- æ‰€æœ‰QQEä¿¡å·éƒ½è¢«æ¥å—ï¼Œæ²¡æœ‰è´¨é‡ç­›é€‰

**å»ºè®®æ”¹è¿›**:
```bash
# å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä½¿ç”¨è´¨é‡é˜ˆå€¼
python3 backtest.py --quality-thresholds 60 --budget 1000000
```

**è´¨é‡å› å­æƒé‡è°ƒæ•´å»ºè®®**:
```python
# å½“å‰8å› å­æƒé‡ä¼˜åŒ–
1. QQEè¶‹åŠ¿å¼ºåº¦: 20åˆ† (æœ€é‡è¦)
2. æˆäº¤é‡ç¡®è®¤: 15åˆ† (å¢åŠ æƒé‡)
3. RSIä½ç½®: 10åˆ†
4. åŠ¨é‡å¼ºåº¦: 15åˆ† (å¢åŠ æƒé‡)
5. æ³¢åŠ¨ç‡: 5åˆ†
6. è¶‹åŠ¿æŒç»­æ€§: 15åˆ† (å¢åŠ æƒé‡)
7. çªç ´ç¡®è®¤: 10åˆ†
8. ä»·æ ¼ä½ç½®: 10åˆ†
```

**é¢„æœŸæ•ˆæœ**:
- è¿‡æ»¤æ‰çº¦40-50%çš„ä½è´¨é‡ä¿¡å·
- èƒœç‡æå‡è‡³50%ä»¥ä¸Š
- å‡å°‘äºæŸäº¤æ˜“æ¬¡æ•°

---

### ä¼˜åŒ–æ–¹å‘5: **åŠ¨æ€ä»“ä½ç®¡ç†**

**å½“å‰é—®é¢˜**:
- å›ºå®šç­‰æƒåˆ†é…èµ„é‡‘
- ä¸åŒºåˆ†ä¿¡å·è´¨é‡çš„ä»“ä½å¤§å°

**å»ºè®®æ”¹è¿›**:
```python
# åŸºäºä¿¡å·è´¨é‡çš„ä»“ä½åˆ†é…
è´¨é‡åˆ† 70-80: ä»“ä½ 25% (æ»¡ä»“)
è´¨é‡åˆ† 60-70: ä»“ä½ 20%
è´¨é‡åˆ† 50-60: ä»“ä½ 15%
è´¨é‡åˆ† <50:  ä¸ä¹°å…¥

# åŸºäºæ³¢åŠ¨ç‡çš„ä»“ä½è°ƒæ•´
ä½æ³¢åŠ¨(ATR<3%): ä»“ä½ +5%
é«˜æ³¢åŠ¨(ATR>7%): ä»“ä½ -5%
```

---

## ğŸ“ å…·ä½“ä»£ç ä¼˜åŒ–æ–¹æ¡ˆ

### ä¿®æ”¹1: æ¸è¿›å¼æ­¢æŸ

```python
# åœ¨ _process_daily_step ä¸­ä¿®æ”¹æ­¢æŸé€»è¾‘
def _process_daily_step(self, date_str, daily_market, min_quality):
    for code, pos in self.positions.items():
        if code not in daily_market:
            continue
        
        data = daily_market[code]
        buy_cost = pos['cost_price']
        
        # è®¡ç®—æŒæœ‰å¤©æ•°
        from datetime import datetime as dt
        buy_date = dt.strptime(pos['buy_date'], '%Y-%m-%d')
        current_date = dt.strptime(date_str, '%Y-%m-%d')
        hold_days = (current_date - buy_date).days
        
        # æ¸è¿›å¼æ­¢æŸ
        if hold_days < 5:
            stop_loss_pct = 0.12  # å‰5å¤©å®½æ¾
        elif hold_days < 15:
            stop_loss_pct = 0.10  # 5-15å¤©ä¸­ç­‰
        else:
            stop_loss_pct = 0.08  # 15å¤©åä¸¥æ ¼
        
        stop_price = buy_cost * (1 - stop_loss_pct)
        
        if data['low'] <= stop_price:
            # è§¦å‘æ­¢æŸ...
```

### ä¿®æ”¹2: å¤šçº§æ­¢ç›ˆ

```python
def _process_daily_step(self, date_str, daily_market, min_quality):
    for code, pos in self.positions.items():
        data = daily_market[code]
        buy_cost = pos['cost_price']
        current_price = data['close']
        profit_pct = (current_price - buy_cost) / buy_cost
        
        # å¤šçº§æ­¢ç›ˆ
        if not pos.get('tp_level_1') and profit_pct >= 0.10:
            # 10%æ­¢ç›ˆï¼Œå–å‡º30%
            self._execute_sell(date_str, code, data['name'], current_price, 
                             sell_pct=0.3, reason="æ­¢ç›ˆ10%-30%")
            pos['tp_level_1'] = True
            
        elif not pos.get('tp_level_2') and profit_pct >= 0.15:
            # 15%æ­¢ç›ˆï¼Œå†å–30%
            self._execute_sell(date_str, code, data['name'], current_price, 
                             sell_pct=0.3, reason="æ­¢ç›ˆ15%-30%")
            pos['tp_level_2'] = True
            
        elif not pos.get('tp_level_3') and profit_pct >= 0.20:
            # 20%æ­¢ç›ˆï¼Œå–å‡ºå‰©ä½™
            self._execute_sell(date_str, code, data['name'], current_price, 
                             is_partial=False, reason="æ­¢ç›ˆ20%-æ¸…ä»“")
```

### ä¿®æ”¹3: æœ€å°æŒä»“å¤©æ•°è¿‡æ»¤

```python
# åœ¨å–å‡ºä¿¡å·åˆ¤æ–­å‰æ·»åŠ 
if data['sell_signal']:
    # æ£€æŸ¥æŒæœ‰å¤©æ•°
    hold_days = (current_date - buy_date).days
    
    if hold_days < 5:
        # æŒä»“ä¸è¶³5å¤©ï¼Œå¿½ç•¥å–å‡ºä¿¡å·
        continue
    
    action = "SELL"
    reason = "å–å‡ºä¿¡å·"
    sell_price = data['close']
```

---

## ğŸ”¢ ä¼˜åŒ–åé¢„æœŸæ•ˆæœ

åŸºäºå½“å‰æ•°æ®æ¨ç®—ï¼Œåº”ç”¨ä¸Šè¿°ä¼˜åŒ–åï¼š

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å(é¢„æœŸ) | æ”¹å–„ |
|------|------|------------|------|
| èƒœç‡ | 38.6% | **52-58%** | +35% |
| ç›ˆäºæ¯” | 1.93:1 | **2.5:1** | +30% |
| å¹³å‡æŒä»“ | 22.3å¤© | **28-32å¤©** | +35% |
| æ­¢æŸæ¬¡æ•° | 17æ¬¡(38.6%) | **8-10æ¬¡(20%)** | -50% |
| æ­¢ç›ˆæ¬¡æ•° | 7æ¬¡(15.9%) | **18-22æ¬¡(45%)** | +180% |
| æ€»æ”¶ç›Š | Â¥60,770 | **Â¥180,000-250,000** | +200-300% |
| æ”¶ç›Šç‡ | 6.08% | **18-25%** | +200-300% |

---

## ğŸš€ ç«‹å³å¯ç”¨çš„ä¼˜åŒ–å‘½ä»¤

### æµ‹è¯•æ–¹æ¡ˆ1: å¯ç”¨ä¸¥æ ¼æ¨¡å¼
```bash
python3 backtest.py \
  --budget 1000000 \
  --max-stocks 100 \
  --max-positions 5 \
  --quality-thresholds 60 \
  --stop-loss 0.12 \
  --take-profit 0.20 \
  --board chinext+star
```

### æµ‹è¯•æ–¹æ¡ˆ2: å¯¹æ¯”å¤šä¸ªæ­¢æŸæ¯”ä¾‹
```bash
python3 backtest.py \
  --budget 1000000 \
  --max-stocks 100 \
  --stop-loss 0.08 \
  --no-strict
  
python3 backtest.py \
  --budget 1000000 \
  --max-stocks 100 \
  --stop-loss 0.12 \
  --no-strict
```

---

## ğŸ“Œ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… ç«‹å³æµ‹è¯•: è¿è¡Œä¸¥æ ¼æ¨¡å¼å¯¹æ¯”å½“å‰ç»“æœ
2. âœ… ä»£ç ä¿®æ”¹: å®ç°æ¸è¿›å¼æ­¢æŸ
3. âœ… ä»£ç ä¿®æ”¹: å®ç°å¤šçº§æ­¢ç›ˆ
4. âœ… ä»£ç ä¿®æ”¹: æ·»åŠ æœ€å°æŒä»“å¤©æ•°è¿‡æ»¤
5. âœ… å›æµ‹éªŒè¯: ä½¿ç”¨ç›¸åŒæ•°æ®éªŒè¯æ”¹è¿›æ•ˆæœ
6. âœ… å‚æ•°ä¼˜åŒ–: ç½‘æ ¼æœç´¢æœ€ä¼˜æ­¢æŸ/æ­¢ç›ˆå‚æ•°

